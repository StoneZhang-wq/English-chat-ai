---
description: 修改板块时联动检查相关板块、废弃代码需经用户确认后删除
alwaysApply: true
---

# 板块修改联动规则

修改任一板块时，**必须**按以下关系检查并同步修改相关板块。

## 联动表

| 修改板块 | 需同时检查的板块 | 主要文件 |
|----------|------------------|----------|
| 1 账户 | 2, 4, 5, 6, 7, 8, 10, 13, 14 | shared.py, memory_system.py |
| 2 中文沟通 | 4, 5 | app_logic.py, memory_system.py |
| 3 语音输入 | 4, 7 | transcription.py, main.py |
| 4 AI对话 | 2, 5, 6 | app.py, app_logic.py, doubao/ |
| 5 摘要 | 2, 6, 14 | memory_system.py |
| 6 英语卡片 | 4, 7, 8, 10, 13, 14 | memory_system.py, knowledge_db.py |
| 7 练习 | 6, 8, 11, 12, 13 | main.py, app.py |
| 8 知识库 | 6, 7, 14 | knowledge_db.py |
| 9 WebSocket | 1-14（涉及实时推送时） | main.py, shared.py |
| 10 难度与水平 | 6, 8 | memory_system.py, shared.py |
| 11 复习笔记 | 7, 13 | main.py |
| 12 场景拓展 | 7 | main.py |
| 13 练习记忆 | 6, 7, 11 | memory_system.py |
| 14 场景选择与推荐 | 6, 8 | knowledge_db.py, memory_system.py |

## 修改后必须完成

1. 更新 `docs/PROJECT_FLOW.md` 中对应板块的「实现」和「功能」描述（如有变化）
2. 检查联动表中列出的相关板块是否需要改动
3. 若发现联动表已过时，按「元规则」更新本规则

## 数据来源

- 板块与依赖关系的权威描述在 `docs/PROJECT_FLOW.md`
- 本规则的联动表是 PROJECT_FLOW 的摘要，用于快速提醒
- 两者不一致时，以 PROJECT_FLOW 为准，并应立即更新本规则表格以恢复一致

## 废弃代码清理规则

当新增功能**覆盖**或**优化**了既有功能时：

1. **识别**：找出旧功能中已无用的部分，或整体可废弃的旧功能
2. **提议**：明确列出拟删除的代码/模块，并说明被何新功能替代
3. **确认**：**必须经用户明确同意后**才可执行删除，不得擅自删除

**禁止**：在未获用户批准前执行任何删除操作。

---

## 元规则：保持本规则与 PROJECT_FLOW 同步

当发生以下任一情况时，**必须**同步更新本规则中的「联动表」：

- 在 `docs/PROJECT_FLOW.md` 中新增、删除、合并板块
- 修改板块的依赖关系（如板块 6 新增对板块 3 的依赖）
- 板块对应的文件/API 发生结构性变化

**操作**：修改 `docs/PROJECT_FLOW.md` 后，检查本规则中的联动表是否仍准确，若已过时则更新。

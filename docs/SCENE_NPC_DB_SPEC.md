# 场景-NPC 数据库规范（SCENE_NPC_DB_SPEC v2.0）

> **核心逻辑**：不再按难度划分，只按真实生活场景划分。原数据库中的 **Unit** 等价于现在的 **NPC**。
>
> **结构**：大场景 → 小场景 → NPC → 多套预制对话  
> **双端使用**：学习页（学模板）+ 沉浸式（实战），同一套数据库，内容有关联但不重复。

---

## 一、整体结构

```
大场景（6 个）
  └── 小场景（如：咖啡馆、餐厅、超市…）
        └── NPC（如：服务员、顾客、店员…）
              └── 3 套预制对话（框架一致，内容轻微变化，不重复、不跑偏）
```

- **学习页**：用户学某小场景的模板对话 → 学完即解锁该小场景的沉浸式
- **沉浸式**：点击不同 NPC，触发不同版本的实战对话；全程预制 + 选项，不走自由 AI

---

## 二、大场景与小场景 + NPC（完整清单）

### 1）日常生活

| 小场景 | NPC |
|--------|-----|
| 家 / 居家 | 家人、室友 |
| 小区 / 楼下 | 邻居、保安、快递员、外卖员 |
| 公园 / 户外 | 路人、晨练老人 |
| 医院 / 诊所 | 医生、护士、挂号收费员 |
| 银行 | 柜员、大堂经理 |

### 2）餐饮美食

| 小场景 | NPC |
|--------|-----|
| 咖啡馆 | 服务员、咖啡师、顾客 |
| 餐厅 / 饭店 | 迎宾、服务员、收银员 |
| 快餐店 | 点餐员、配餐员 |
| 小吃店 / 奶茶店 | 店员、老板 |

### 3）出行交通

| 小场景 | NPC |
|--------|-----|
| 机场 | 地勤、安检员、空姐/空少 |
| 火车站 / 高铁站 | 售票员、检票员 |
| 地铁 / 公交 | 司机、售票员 |
| 出租车 / 网约车 | 司机 |
| 酒店 | 前台、客房服务、保洁 |

### 4）购物消费

| 小场景 | NPC |
|--------|-----|
| 超市 / 便利店 | 收银员、导购员 |
| 商场 / 服装店 | 店员、导购 |
| 理发店 | 理发师、前台 |
| 电影院 | 售票员、检票员 |

### 5）工作职场

| 小场景 | NPC |
|--------|-----|
| 办公室 | 领导、同事、下属 |
| 面试 | 面试官 |
| 会议 / 接待 | 客户、合作伙伴 |
| 电话沟通 | 客服、接线员 |

### 6）社交人情

| 小场景 | NPC |
|--------|-----|
| 朋友聚会 | 朋友、同学 |
| 打招呼 / 闲聊 | 陌生人 |
| 兴趣爱好 | 玩伴、同好 |
| 赞美 / 安慰 / 道歉 | 通用 NPC（朋友 / 同事 / 家人） |

---

## 三、数据格式（JSON / 文件后端）

### 主数据文件（仅文件后端，无 MySQL）

- **场景与 NPC 清单**：从 `data/dialogues.json` 推导（含 big_scene_name、small_scene_name、npc_name）
- **预制对话**：`data/dialogues.json`（每条记录对应一个「NPC + 对话套」）

### 每条对话记录字段

| 字段 | 类型 | 说明 |
|------|------|------|
| `big_scene` | string | 大场景：日常生活 / 餐饮美食 / 出行交通 / 购物消费 / 工作职场 / 社交人情 |
| `small_scene` | string | 小场景：咖啡馆 / 餐厅 / 超市 … |
| `npc` | string | NPC 名称：服务员 / 顾客 / 店员 … |
| `dialogue_set` | int | 对话套号：1 / 2 / 3（同 NPC 下 3 套，框架一致、内容有变） |
| `usage` | string | 用途：`learn`（学习页） / `review`（复习资料） / `immersive`（沉浸式，仅第三套） |
| `dialogue_id` | string | 唯一 ID，建议格式：`大场景缩写-小场景缩写-NPC缩写-套号` |
| `content` | array | 对话内容，每项 `{"role":"A"|"B", "content":"...", "hint":"..."}` |
| `core_sentences` | string | 核心句型，用 `/` 分隔 |
| `core_chunks` | string | 核心语块，用 `/` 分隔 |

### 规则约定

- **角色约定（重要）**：`role` 必须为 **A = NPC（对方角色）**，**B = 用户（学习者）**。对话可以 A 或 B 开头。
- **每 NPC 配 3 套对话**：`dialogue_set` 为 1、2、3
- **usage**：  
  - 学习页：`dialogue_set` 1 = `learn`（模板对话）  
  - 复习：`dialogue_set` 2 = `review`（复习资料）  
  - 沉浸式：`dialogue_set` 3 = `immersive`（仅第三套用于沉浸式）
- **content 格式**：`role` A=NPC、B=用户，含 `hint` 提示（hint 对应 B 行，即用户应说的内容）
- **content 长度**：建议统一 4～8 轮（8～16 条），可按小场景类型微调

---

## 四、对话 ID 规则

**格式**：`{big_scene_abbr}-{small_scene_abbr}-{npc_abbr}-{set}`

### 大场景缩写

| 大场景 | 缩写 |
|--------|------|
| 日常生活 | DL |
| 餐饮美食 | CY |
| 出行交通 | CX |
| 购物消费 | GW |
| 工作职场 | GZ |
| 社交人情 | SJ |

### 小场景与 NPC 缩写（示例，可扩展）

- 小场景：取拼音首字母或约定缩写（如 咖啡馆→KF、餐厅→CT、超市→CS）
- NPC：取角色简称（如 服务员→FW、顾客→GK、店员→DY）

**示例**：`CY-KF-FW-1` = 餐饮美食-咖啡馆-服务员-第 1 套

---

## 五、学习页与沉浸式对应关系

| 端 | 数据筛选 | 解锁逻辑 |
|----|----------|----------|
| 学习页 | `usage = 'learn'`（dialogue_set 1） | 学完某小场景下所有 NPC 的 learn 对话 → 该小场景沉浸式解锁 |
| 复习 | `usage = 'review'`（dialogue_set 2） | 学习后生成复习资料 |
| 沉浸式 | `usage = 'immersive'`（dialogue_set 3，仅第三套） | 仅当该 small_scene 已解锁时，用户可进入并点击 NPC |

---

## 六、对话内容规则

1. **同一 NPC 的 3 套**：框架（句型、轮次、hint 结构）一致，仅替换具体用词和细节
2. **三套分工**：学习页用 set 1；复习用 set 2；沉浸式只用 set 3，内容不重复
3. **口语自然度**：优先真实口语高频表达，允许自然省略和承接语
4. **不跑题**：整段对话有明确交际目标，轮与轮有上下文

---

## 七、小场景 → 沉浸式 scene_id 映射（供前端用）

| 小场景 | 沉浸式 scene_id | 说明 |
|--------|-----------------|------|
| 咖啡馆 | cafe | 咖啡馆背景 + 服务员、咖啡师、顾客 |
| 餐厅 / 饭店 | restaurant | 餐厅背景 + 迎宾、服务员、收银员 |
| 超市 / 便利店 | supermarket | 超市背景 + 收银员、导购员 |
| 酒店 | hotel | 酒店背景 + 前台、客房服务、保洁 |
| 办公室 | office | 办公室背景 + 领导、同事、下属 |
| … | … | 按需扩展 |

---

## 八、与旧结构对照

| 旧（ORAL_TRAINING_DB） | 新（SCENE_NPC_DB） |
|------------------------|--------------------|
| scene (如 Daily Life) | big_scene + small_scene |
| difficulty | 不再使用 |
| unit (如 U1-Daily Routine) | npc |
| batch (A/B/C/Review) | dialogue_set (1/2/3) + usage (learn/immersive) |

---

## 九、检查清单

- [ ] 每条对话的 `big_scene`、`small_scene`、`npc` 均在上述清单内
- [ ] 每 NPC 有且仅有 3 套 `dialogue_set`（1、2、3）
- [ ] 每 NPC 有 3 套：set 1 = learn，set 2 = review，set 3 = immersive
- [ ] 沉浸式仅使用 `usage = 'immersive'`（dialogue_set 3）
- [ ] `content` 为数组，每项含 `role`、`content`、`hint`
- [ ] `core_sentences`、`core_chunks` 与对话内容一致
